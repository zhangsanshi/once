!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.Once=n():t.Once=n()}(this,function(){return function(t){function n(o){if(e[o])return e[o].exports;var i=e[o]={exports:{},id:o,loaded:!1};return t[o].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}var e={};return n.m=t,n.c=e,n.p="",n(0)}([function(t,n,e){"use strict";function o(t,n,e){var o=i[t];return e=e||{},o||s.isFunction(n)&&(o=i[t]=r(n,e)),o}var i=e(1),r=e(3),s=e(2);o.one=function(t,n,e){var i,r=this;return arguments.length>1&&(e=e||{},i=e.afterDone,e.one=!0,e.afterDone=function(){i&&s.isFunction(i)&&i(),r.remove(t)}),o(t,n,e)},o.remove=function(t){var n=i[t];n&&(n.destory(),delete i[t])},t.exports=o},function(t,n){"use strict";t.exports={}},function(t,n,e){"use strict";var o=e(1);t.exports={toString:o.toString,isFunction:function(t){return t&&"[object Function]"===this.toString.call(t)},isPromise:function(t){return t&&this.isFunction(t.then)}}},function(t,n,e){"use strict";var o=e(2);t.exports=function(t,n){var e,i,r,s,u={status:"pending",updateStatus:function(t){return this.status=t,this},isDoing:function(){return"doing"===this.status},isDestory:function(){return"destory"===this.status},destory:function(){this.updateStatus("destory"),this.machine=null}};return n=n||{},e=n.afterDoing,i=n.afterDone,r=n.one,u.machine=t,{run:function(){function t(){i.done()}var n,i=this;if(u.isDestory())return s;if(!u.isDoing()){u.updateStatus("doing");try{n=u.machine()}catch(c){throw u.updateStatus("pending"),new Error(c)}o.isFunction(e)&&e(),o.isPromise(n)&&(n=n.then(t,t))}return r&&(s=n),n},getStatus:function(){return u.status},done:function(){return u.isDestory()&&!u.isDoing()?null:(u.isDoing()&&(u.updateStatus("done"),o.isFunction(i)&&i()),r&&this.destory(),this)},destory:function(){u.destory()}}}}])});